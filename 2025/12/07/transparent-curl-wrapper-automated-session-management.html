<!doctype html><html class="h-full"><head><meta charset="utf-8" /><meta content="ie=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" /><title>gaultier.dev</title><link href="../../../images/favicon.ico" rel="icon" type="image/x-icon" /><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><script data-website-id="58e0c11c-be1a-4563-a97f-9005d206fd48" defer="" src="https://umami.canonic.fr/script.js"></script><link href="../../../stylesheets/site.css" rel="stylesheet" /><script type="importmap">
  {
  "imports": {
    "@hotwired/stimulus": "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js",
    "tocbot": "https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.30.0/tocbot.min.js",
    "highlight.js": "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/es/highlight.min.js"
  }
}


</script>
<script
  type="module"
  src="../../../javascripts/site.js"
></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.30.0/tocbot.css" rel="stylesheet" /></head><body class="h-full flex flex-col"><header><nav class="p-12 bg-gray-100"><a href="../../../"><span class="font-serif text-2xl font-semibold whitespace-nowrap text-gray-800">gaultier.dev</span></a><div><ul class="flex gap-4 mt-8 text-gray-800"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/links">Links</a></li></ul></div></nav></header><main class="flex-1 p-12"><div data-controller="lol"><article class="prose prose-code:before:hidden prose-code:after:hidden prose-headings:font-serif " data-controller="highlightjs" data-lol-target="source"><h1 id="testing-authenticated-endpoints-with-claude">Testing authenticated endpoints with Claude</h1>

<div class="tldr">
<strong>TL;DR</strong>: I wrap curl and share a cookie jar so Claude can test authenticated endpoints without interactive login.
</div>

<p>While working on a backend app, I wanted Claude to be able to <strong>test the API it’s implementing</strong>.</p>

<p>Most endpoints are authenticated. Claude can run <code class="prettyprint">curl</code>, but it can’t log in interactively or keep cookies across commands. That means it gets stuck as soon as auth is involved.</p>

<p>The trick is to log in once as a human, persist the session cookies, and make every curl call reuse them.</p>

<h2 id="wrap-curl">Wrap curl</h2>

<p>I shadow <code class="prettyprint">curl</code> inside the project with a small wrapper:</p>
<div class="not-prose">
  <pre><code class="language-bash">#!/bin/sh
SCRIPT_DIR=&quot;$(cd &quot;$(dirname &quot;$0&quot;)&quot; &amp;&amp; pwd)&quot;
/usr/bin/curl -K &quot;$SCRIPT_DIR/.curlrc&quot; &quot;$@&quot;
</code></pre>
</div>

<p>Saved as <code class="prettyprint">${project_root}/bin/xcurl</code>, this behaves like curl but always loads a local <code class="prettyprint">.curlrc</code>.</p>

<h2 id="share-cookies">Share cookies</h2>

<p>The <code class="prettyprint">.curlrc</code> file persists the session:</p>
<div class="not-prose">
  <pre><code class="language-ini">cookie-jar = &quot;./tmp/cookies.txt&quot;
cookie = &quot;./tmp/cookies.txt&quot;
location
</code></pre>
</div>

<p>Once the cookie is there, all requests are authenticated.</p>

<h2 id="log-in-once">Log in once</h2>

<p>A simple <code class="prettyprint">bin/login</code> script performs the login flow (CSRF + POST credentials) using <code class="prettyprint">xcurl</code>, which populates the cookie jar:</p>
<div class="not-prose">
  <pre><code class="language-bash">bin/login admin password
</code></pre>
</div>

<p>I do this once per session.</p>

<h2 id="make-it-available">Make it available</h2>

<p>I use <code class="prettyprint">direnv</code> to add <code class="prettyprint">bin/</code> to <code class="prettyprint">PATH</code>:</p>
<div class="not-prose">
  <pre><code class="language-bash"># .envrc
PATH_add bin
</code></pre>
</div>

<p>Now when Claude runs commands in the project, it automatically uses <code class="prettyprint">xcurl</code>.</p>

<h2 id="usage">Usage</h2>

<p>Claude can test authenticated endpoints directly:</p>
<div class="not-prose">
  <pre><code class="language-bash">xcurl http://localhost:5000/api/users
xcurl -X POST http://localhost:5000/api/sync
</code></pre>
</div>

<p>I usually document this in <code class="prettyprint">CLAUDE.md</code> to avoid confusion:</p>
<div class="not-prose">
  <pre><code class="language-markdown"># Testing
- use xcurl for API calls
- if you get a 302 redirect, run `login admin password`
</code></pre>
</div>

<h2 id="notes">Notes</h2>

<ul>
<li>Cookie-based auth only</li>
<li>Cookie file should not be committed</li>
</ul>

<p>Claude can verify what it generates, yay !</p>
</article></div></main><footer><nav class="bg-gray-100 p-12"><div><ul class="flex gap-4 mt-8 text-gray-800"><li><a href="../../../feed.xml">rss</a></li></ul></div></nav></footer></body></html>